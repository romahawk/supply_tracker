{% extends "base_clean.html" %}
{% block title %}Stock IN Report{% endblock %}
{% block body %}

<!-- Top Buttons -->
<div class="flex justify-end gap-3 px-[50px] mt-6 no-print">
  {% if entries and entries|length > 0 %}
    <form method="POST" action="{{ url_for('warehouse.delete_stockreport', entry_id=entries[0].id) }}"
      onsubmit="return confirm('Delete this entry?')">
      <button type="submit" class="bg-red-700 hover:bg-red-800 text-white px-4 py-2 rounded shadow text-sm">üóëÔ∏è Delete</button>
    </form>
  {% endif %}
  <button id="edit-all-btn" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded shadow text-sm">‚úèÔ∏è Edit All</button>
  <button id="save-stockreport-btn"
    class="bg-green-700 hover:bg-green-800 text-white px-4 py-2 rounded shadow text-sm hidden">üíæ Save</button>
  <button onclick="window.print()" class="bg-gray-700 hover:bg-gray-900 text-white px-4 py-2 rounded shadow text-sm">üñ®Ô∏è Print</button>
</div>


<!-- Report Block -->
<div class="print-area bg-white dark:bg-gray-800 p-6 rounded shadow max-w-full px-[50px] mt-6" id="pdf-report">
  <div class="flex justify-between items-start mb-6">
    <div>
      <h2 class="text-2xl font-bold mb-2">Stock IN Report</h2>
      <pre class="text-xs text-red-500 bg-yellow-100 p-2 rounded">DEBUG: {{ item }}</pre>

      <div class="grid grid-cols-2 gap-4 mb-6 text-sm">
        {% for label, field in [("Warehouse", "warehouse_address"), ("Pos. No.", "pos_no"), ("Client", "client"),
        ("Client Ref.", "customer_ref")] %}
        <div>
          <span class="font-semibold">{{ label }}:</span>
          <div class="ml-2 view-mode">{{ item[field] or '‚Äî' }}</div>
          <div class="edit-header hidden">
            <input type="text" name="{{ field }}" value="{{ item[field] or '' }}"
              class="w-full mt-1 border px-2 py-1 rounded text-sm bg-white dark:bg-gray-700" />
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    <img src="{{ url_for('static', filename='images/logo.jpg') }}" alt="Logo" class="w-36 object-contain h-auto">
  </div>

  <!-- Table -->
  <div class="overflow-auto">
    <table class="w-full text-sm text-left border" id="stockreport-table">
      <thead class="bg-gray-100 dark:bg-gray-700 text-xs text-gray-700 dark:text-gray-300">
        <tr>
          <th class="p-2 border">Entrance</th>
          <th class="p-2 border">Article/Batch</th>
          <th class="p-2 border">Colli</th>
          <th class="p-2 border">Packing</th>
          <th class="p-2 border">PCS</th>
          <th class="p-2 border">Colli/Pal.</th>
          <th class="p-2 border">Pcs Total</th>
          <th class="p-2 border">Pal.</th>
          <th class="p-2 border">Product</th>
          <th class="p-2 border">Gross kg</th>
          <th class="p-2 border">Net kg</th>
          <th class="p-2 border">Sender</th>
          <th class="p-2 border">Customs</th>
          <th class="p-2 border">Stockref</th>
        </tr>
      </thead>
      <tbody>
        {% for entry in entries %}
        <tr class="border-t" data-entry-id="{{ entry.id }}">
          {% for field in ["entrance_date", "article_batch", "colli", "packing", "pcs", "colli_per_pal", "pcs_total",
          "pal", "product", "gross_kg", "net_kg", "sender", "customs_status", "stockref"] %}
          <td class="p-2 border">
            <div class="view-mode">{{ entry[field] }}</div>
            <div class="edit-header hidden">
              {% if field == "customs_status" %}
              <select name="{{ field }}">
                <option value="EU" {% if entry[field]=='EU' %}selected{% endif %}>EU</option>
                <option value="T1" {% if entry[field]=='T1' %}selected{% endif %}>T1</option>
              </select>
              {% elif field in ["colli", "pcs", "colli_per_pal", "pcs_total", "pal", "gross_kg", "net_kg"] %}
              <input type="number" name="{{ field }}" value="{{ entry[field] }}">
              {% elif field == "entrance_date" %}
              <input type="date" name="{{ field }}" value="{{ entry[field] }}">
              {% else %}
              <input type="text" name="{{ field }}" value="{{ entry[field] }}">
              {% endif %}
            </div>
          </td>
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Customs Info -->
  <div class="grid grid-cols-3 gap-4 mt-8 text-sm">
    {% for label, field in [("ATB First", "atb_first"), ("Customs OZL", "customs_ozl"), ("Free till", "free_till")] %}
    <div>
      <label class="font-medium">{{ label }}:</label>
      <div class="view-mode text-gray-700">{{ item[field] or "‚Äî" }}</div>
      <div class="edit-header hidden">
        <input type="text" name="{{ field }}" value="{{ item[field] or '' }}"
          class="w-full mt-1 border px-2 py-1 rounded text-sm bg-white dark:bg-gray-700" />
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Signatures -->
  <div class="grid grid-cols-2 gap-8 mt-10">
    {% for side, date, sig in [('client', signature_date_client, signature_client), ('warehouse',
    signature_date_warehouse, signature_warehouse)] %}
    <div class="text-center">
      <div class="view-mode">
        <p class="text-sm text-gray-700 mb-1">Date: {{ date or '‚Äî' }}</p>
        <img src="{{ url_for('static', filename='images/signatures/' + (sig or 'signature1.png')) }}" alt="Signature"
          class="mx-auto w-32 h-auto mb-2">
        <div class="border-t border-black w-2/3 mx-auto"></div>
        <p class="text-sm mt-1 capitalize">Signature {{ side }}</p>
      </div>
      <div class="edit-header hidden space-y-2">
        <input type="date" name="signature_date_{{ side }}" value="{{ date or '' }}"
          class="w-full border px-3 py-1 rounded" />
        <select name="signature_{{ side }}" class="w-full border rounded px-2 py-1">
          {% for s in ['signature1.png', 'signature2.png', 'signature3.png'] %}
          <option value="{{ s }}" {% if sig==s %}selected{% endif %}>{{ s }}</option>
          {% endfor %}
        </select>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/view_stockreport.js') }}?v={{ config['VERSION'] }}"></script>
{% endblock %}
